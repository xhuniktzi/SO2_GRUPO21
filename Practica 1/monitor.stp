#! /usr/bin/stap

global syscall_count
global read_count
global write_count
global open_count

probe syscall.read, syscall.write, syscall.open
{
    if (pid() != ppid()) {
        printf("Process %d: %s (%s)\n", pid(), name, ctime(gettimeofday_s()))
        syscall_count++
        if (name == "read") read_count++
        if (name == "write") write_count++
        if (name == "open") open_count++
    }
}

probe end
{
    printf("Total system calls: %d\n", syscall_count)
    printf("Read: %d, Write: %d, Open: %d\n", read_count, write_count, open_count)
}

